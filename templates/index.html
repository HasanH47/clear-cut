<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClearCut - AI Background Remover</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .drop-zone {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .drop-zone.dragover {
            transform: scale(1.02);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .processing {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-up {
            animation: slideUp 0.6s ease-out;
        }
        .feature-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-purple-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-cut text-white"></i>
                    </div>
                    <h1 class="text-2xl font-bold gradient-text">ClearCut</h1>
                </div>
                <div class="text-sm text-gray-600">
                    <i class="fas fa-shield-alt mr-1"></i>
                    Privacy-First & Open Source
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Hero Section -->
        <div class="text-center mb-12 slide-up">
            <h2 class="text-4xl font-bold text-gray-900 mb-4">
                Remove Backgrounds with <span class="gradient-text">AI Precision</span>
            </h2>
            <p class="text-xl text-gray-600 mb-8 max-w-3xl mx-auto">
                High-quality background removal powered by machine learning. 
                No data stored, completely private, and lightning fast.
            </p>
        </div>

        <!-- Upload Section -->
        <div class="grid lg:grid-cols-2 gap-8 mb-12">
            <!-- Upload Area -->
            <div class="space-y-6">
                <div class="glass-effect rounded-2xl p-8">
                    <h3 class="text-2xl font-bold text-gray-900 mb-6">Upload Your Image</h3>
                    
                    <!-- Drag & Drop Zone -->
                    <div id="dropZone" class="drop-zone border-2 border-dashed border-white rounded-xl p-12 text-center text-white cursor-pointer mb-6">
                        <div id="dropContent">
                            <i class="fas fa-cloud-upload-alt text-5xl mb-4 opacity-80"></i>
                            <p class="text-xl font-semibold mb-2">Drag & drop your image here</p>
                            <p class="text-sm opacity-80">or click to browse files</p>
                            <p class="text-xs mt-2 opacity-60">JPG, PNG, WebP up to 10MB</p>
                        </div>
                    </div>

                    <input type="file" id="fileInput" accept="image/*" class="hidden">

                    <!-- URL Input -->
                    <div class="relative">
                        <input type="url" id="urlInput" placeholder="Or paste image URL here..." 
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <button id="urlSubmit" class="absolute right-2 top-2 px-4 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors">
                            <i class="fas fa-download"></i>
                        </button>
                    </div>
                </div>

                <!-- Features -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="feature-card bg-white rounded-xl p-6 shadow-sm">
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mb-4">
                            <i class="fas fa-shield-alt text-green-600 text-xl"></i>
                        </div>
                        <h4 class="font-bold text-gray-900 mb-2">100% Private</h4>
                        <p class="text-gray-600 text-sm">No data stored on servers</p>
                    </div>
                    <div class="feature-card bg-white rounded-xl p-6 shadow-sm">
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mb-4">
                            <i class="fas fa-magic text-blue-600 text-xl"></i>
                        </div>
                        <h4 class="font-bold text-gray-900 mb-2">AI Powered</h4>
                        <p class="text-gray-600 text-sm">Advanced ML algorithms</p>
                    </div>
                </div>
            </div>

            <!-- Preview Area -->
            <div class="space-y-6">
                <div class="glass-effect rounded-2xl p-8 min-h-96">
                    <h3 class="text-2xl font-bold text-gray-900 mb-6">Preview & Download</h3>
                    
                    <div id="previewArea" class="hidden">
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="text-center">
                                <p class="text-sm font-medium text-gray-700 mb-2">Original</p>
                                <div class="bg-gray-100 rounded-lg overflow-hidden">
                                    <img id="originalPreview" class="w-full h-auto max-h-64 object-contain">
                                </div>
                            </div>
                            <div class="text-center">
                                <p class="text-sm font-medium text-gray-700 mb-2">Background Removed</p>
                                <div class="bg-transparent bg-opacity-20 rounded-lg overflow-hidden" style="background-image: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\"><rect width=\"10\" height=\"10\" fill=\"%23f0f0f0\"/><rect x=\"10\" y=\"10\" width=\"10\" height=\"10\" fill=\"%23f0f0f0\"/></svg>');">
                                    <img id="resultPreview" class="w-full h-auto max-h-64 object-contain">
                                </div>
                            </div>
                        </div>
                        
                        <div id="processingStats" class="bg-gray-50 rounded-lg p-4 mb-4 text-sm text-gray-600">
                            <!-- Stats will be populated here -->
                        </div>
                        
                        <button id="downloadBtn" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 px-6 rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-300 font-semibold">
                            <i class="fas fa-download mr-2"></i>
                            Download PNG
                        </button>
                    </div>

                    <div id="loadingArea" class="hidden text-center py-12">
                        <div class="processing w-16 h-16 mx-auto mb-4 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-magic text-white text-xl"></i>
                        </div>
                        <p class="text-lg font-semibold text-gray-700 mb-2">Processing your image...</p>
                        <p class="text-sm text-gray-500">This may take a few seconds</p>
                    </div>

                    <div id="placeholderArea" class="text-center py-12 text-gray-400">
                        <i class="fas fa-image text-6xl mb-4"></i>
                        <p class="text-lg">Upload an image to get started</p>
                    </div>
                </div>

                <!-- Additional Features -->
                <div class="grid grid-cols-1 gap-4">
                    <div class="feature-card bg-white rounded-xl p-6 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-bolt text-purple-600"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-900">Lightning Fast</h4>
                                    <p class="text-gray-600 text-sm">Average processing time: 2-5 seconds</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Section -->
        <div class="grid md:grid-cols-3 gap-8 mb-12">
            <div class="feature-card bg-white rounded-xl p-8 shadow-sm text-center">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-trash-alt text-red-600 text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">No Data Storage</h3>
                <p class="text-gray-600">Images are processed in memory and immediately deleted. We never store your data.</p>
            </div>
            
            <div class="feature-card bg-white rounded-xl p-8 shadow-sm text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-code text-green-600 text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">Open Source</h3>
                <p class="text-gray-600">Fully transparent codebase. Self-host or contribute to the project on GitHub.</p>
            </div>
            
            <div class="feature-card bg-white rounded-xl p-8 shadow-sm text-center">
                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-brain text-blue-600 text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-2">AI Enhanced</h3>
                <p class="text-gray-600">U²-Net neural network with post-processing for professional-quality results.</p>
            </div>
        </div>

        <!-- Usage Stats -->
        <div class="glass-effect rounded-2xl p-8 text-center">
            <h3 class="text-2xl font-bold text-gray-900 mb-4">Service Information</h3>
            <div id="serviceStats" class="grid md:grid-cols-4 gap-6 text-sm">
                <div>
                    <div class="text-2xl font-bold gradient-text mb-1">10MB</div>
                    <div class="text-gray-600">Max File Size</div>
                </div>
                <div>
                    <div class="text-2xl font-bold gradient-text mb-1">4</div>
                    <div class="text-gray-600">Supported Formats</div>
                </div>
                <div>
                    <div class="text-2xl font-bold gradient-text mb-1">U²-Net</div>
                    <div class="text-gray-600">AI Model</div>
                </div>
                <div>
                    <div class="text-2xl font-bold gradient-text mb-1">2-5s</div>
                    <div class="text-gray-600">Avg Processing</div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="text-center">
                <div class="flex items-center justify-center space-x-3 mb-4">
                    <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-cut text-white text-sm"></i>
                    </div>
                    <span class="text-xl font-bold gradient-text">ClearCut</span>
                </div>
                <p class="text-gray-600 mb-4">Privacy-first AI background remover</p>
                <div class="flex justify-center space-x-6 text-sm text-gray-500">
                    <span><i class="fas fa-server mr-1"></i>Powered by hasanh.dev</span>
                    <span><i class="fas fa-code mr-1"></i>Open Source</span>
                    <span><i class="fas fa-shield-alt mr-1"></i>Privacy First</span>
                </div>
            </div>
        </div>
    </footer>

    <script>
        let currentFile = null;
        let currentImageUrl = null;

        // DOM Elements
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const urlInput = document.getElementById('urlInput');
        const urlSubmit = document.getElementById('urlSubmit');
        const previewArea = document.getElementById('previewArea');
        const loadingArea = document.getElementById('loadingArea');
        const placeholderArea = document.getElementById('placeholderArea');
        const originalPreview = document.getElementById('originalPreview');
        const resultPreview = document.getElementById('resultPreview');
        const downloadBtn = document.getElementById('downloadBtn');
        const processingStats = document.getElementById('processingStats');

        // Drag and Drop Events
        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', handleDragOver);
        dropZone.addEventListener('dragleave', handleDragLeave);
        dropZone.addEventListener('drop', handleDrop);
        
        fileInput.addEventListener('change', handleFileSelect);
        urlSubmit.addEventListener('click', handleUrlSubmit);
        urlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleUrlSubmit();
        });
        downloadBtn.addEventListener('click', handleDownload);

        function handleDragOver(e) {
            e.preventDefault();
            dropZone.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            dropZone.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                processFile(file);
            }
        }

        function handleUrlSubmit() {
            const url = urlInput.value.trim();
            if (url) {
                processUrl(url);
            }
        }

        function processFile(file) {
            // Validate file
            if (!file.type.startsWith('image/')) {
                showError('Please select a valid image file');
                return;
            }
            
            if (file.size > 10 * 1024 * 1024) {
                showError('File size must be less than 10MB');
                return;
            }

            currentFile = file;
            currentImageUrl = null;
            
            // Show original preview
            const reader = new FileReader();
            reader.onload = (e) => {
                originalPreview.src = e.target.result;
                showPreview();
                processBackground();
            };
            reader.readAsDataURL(file);
        }

        function processUrl(url) {
            currentFile = null;
            currentImageUrl = url;
            
            // Show original preview
            originalPreview.src = url;
            showPreview();
            processBackground();
        }

        function showPreview() {
            placeholderArea.classList.add('hidden');
            previewArea.classList.add('hidden');
            loadingArea.classList.remove('hidden');
        }

        async function processBackground() {
            try {
                const formData = new FormData();
                
                if (currentFile) {
                    formData.append('file', currentFile);
                } else if (currentImageUrl) {
                    formData.append('url', currentImageUrl);
                }

                const response = await fetch('/remove-bg-preview', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                if (result.success) {
                    resultPreview.src = result.preview;
                    
                    // Update stats
                    processingStats.innerHTML = `
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                            <div>
                                <div class="font-semibold text-blue-600">${result.processing_time.toFixed(2)}s</div>
                                <div class="text-xs">Processing Time</div>
                            </div>
                            <div>
                                <div class="font-semibold text-green-600">${formatBytes(result.original_size)}</div>
                                <div class="text-xs">Original Size</div>
                            </div>
                            <div>
                                <div class="font-semibold text-purple-600">${formatBytes(result.result_size)}</div>
                                <div class="text-xs">Result Size</div>
                            </div>
                            <div>
                                <div class="font-semibold text-orange-600">PNG</div>
                                <div class="text-xs">Output Format</div>
                            </div>
                        </div>
                    `;
                    
                    loadingArea.classList.add('hidden');
                    previewArea.classList.remove('hidden');
                } else {
                    throw new Error(result.error || 'Processing failed');
                }
            } catch (error) {
                console.error('Processing error:', error);
                showError('Failed to process image: ' + error.message);
                resetToPlaceholder();
            }
        }

        async function handleDownload() {
            try {
                downloadBtn.disabled = true;
                downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Downloading...';
                
                const formData = new FormData();
                
                if (currentFile) {
                    formData.append('file', currentFile);
                } else if (currentImageUrl) {
                    formData.append('url', currentImageUrl);
                }

                const response = await fetch('/remove-bg', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // Create download link
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `clearcut_${Date.now()}.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);

            } catch (error) {
                console.error('Download error:', error);
                showError('Failed to download image: ' + error.message);
            } finally {
                downloadBtn.disabled = false;
                downloadBtn.innerHTML = '<i class="fas fa-download mr-2"></i>Download PNG';
            }
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function showError(message) {
            // Create toast notification
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform duration-300';
            toast.innerHTML = `<i class="fas fa-exclamation-circle mr-2"></i>${message}`;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.remove('translate-x-full'), 100);
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 5000);
        }

        function resetToPlaceholder() {
            previewArea.classList.add('hidden');
            loadingArea.classList.add('hidden');
            placeholderArea.classList.remove('hidden');
            currentFile = null;
            currentImageUrl = null;
        }

        // Load service stats on page load
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();
                console.log('Service stats loaded:', stats);
            } catch (error) {
                console.log('Could not load service stats');
            }
        });
    </script>
</body>
</html>
